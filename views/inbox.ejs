<div class="split">
	
	<div class="section no_padding fullscreen" style="width: 300px; overflow: hidden;">
		
		<div class="padded">
		
			<a href="#" onclick="localStorage.clear(); location.reload();" style="vertical-align: middle;"><i data-feather="log-out"></i></a> <h3 style="display: inline-block; margin-left: 20px;">Inbox</h3>
			
		</div>
		
		<div class="list interactive" style="overflow: auto; max-height: 80%;">
			
			<% for (const email of await mi.inbox(token)) { %>

				<div class="email" style="position: relative;" data-id="<%- email._id %>">

					<h3><%- /*email.metadata.from.value[0].name ||*/ email.metadata.from.value[0].address %> &mdash; <%- email.metadata.subject %></h3>
					
					<p class="sub"><%- new Date(email.metadata.date).toLocaleString() %> <br> <%- email.metadata.preview %>...</p>
	
				</div>

			<% } %>
			
		</div>
		
	</div>
	
	<div class="section left_border" style="width: calc(100% - 300px);">
		
		<h2 id="preview_subject"></h2>
		
		<div>

			<span><strong style="margin-right: 10px;">FROM</strong> <code id="preview_from"></code> </span>

		</div> <br>

		<div>

			<span><strong style="margin-right: 35px;">TO</strong> <code id="preview_to"></code> </span>

		</div>
		<div>

			<span><strong style="margin-right: 35px;">CC</strong> <code id="preview_cc"></code> </span>

		</div>
		
		<br>

		<iframe id="preview_frame" sandbox="" style="border: none; width: 100%; height: 60%;">

		

		</iframe>

	</div>
	
</div>

<script>

	feather.replace();

	let currentEmail;

	function setPreview (html) {

		document.getElementById("preview_frame").srcdoc = `<style>@import "https://fonts.googleapis.com/css?family=Roboto"; html, body {margin: 0; padding: 0; font-family: "Roboto"}</style>${html}`;

	}

	document.addEventListener("click", async event => {

		/**
		 * @type {Element}
		 */
		const target = event.target;

		if (target.classList.contains("email") || target.offsetParent.classList.contains("email")) {

			if (document.querySelector(".email.hover")) document.querySelector(".email.hover").classList.remove("hover");

			const email = target.classList.contains("email") ? target : target.offsetParent;

			email.classList.add("hover");

			currentEmail = await mi.email(token, email.getAttribute("data-id"));

			document.getElementById("preview_subject").innerText = currentEmail.data.subject;
			
			document.getElementById("preview_from").innerText = currentEmail.data.from.text.slice(0, 64);
			document.getElementById("preview_to").innerText = currentEmail.data.to.text.slice(0, 64);
			if (currentEmail.data.cc) document.getElementById("preview_cc").innerText = currentEmail.data.cc.text.slice(0, 64);

			setPreview(currentEmail.data.html || currentEmail.data.text);

		}

	});
	
</script>
